import r,{createContext as t,useRef as e,useContext as n,useState as a,useCallback as o,useEffect as i,useMemo as u}from"react";var c=function(){return c=Object.assign||function(r){for(var t,e=1,n=arguments.length;e<n;e++)for(var a in t=arguments[e])Object.prototype.hasOwnProperty.call(t,a)&&(r[a]=t[a]);return r},c.apply(this,arguments)};var f=new function r(){for(var t={},e=this,n=0;n<arguments.length;n++){var a=arguments[n];switch(typeof a){case"string":t[a]=[];break;case"object":e=a;break;default:throw new TypeError("Eventjs() only accepts string and object parameters")}}if(e===this&&!(this instanceof r))throw new ReferenceError('Eventjs is not called with "new" keyword and no parameter of type object is passed to it');function o(r){if("string"!=typeof r||!t[r])throw new ReferenceError("The event name does not exist in this event manager: "+r);return!0}return e.on=function(r){o(r);for(var e=1;e<arguments.length;e++){var n=arguments[e];-1===t[r].indexOf(n)&&t[r].push(n)}return this},e.off=function(r){switch(arguments.length){case 0:for(var n in t)t.hasOwnProperty(n)&&e.off(n);break;case 1:o(r),t[r].length=0;break;default:o(r);for(var a=1;a<arguments.length;a++){var i=arguments[a],u=t[r].indexOf(i);-1!==u&&t[r].splice(u,1)}}return this},e.trigger=function(r){o(r);for(var n=[],a=1;a<arguments.length;a++)n.push(arguments[a]);for(var i=t[r],u=[],c=0;c<i.length;c++){var f=i[c];try{f.apply(e,n)}catch(r){u.push({listener:f,error:r})}}if(u.length>0)throw u;return this},e}("event"),s=t(null),h=function(t){var n=t.flagsmith,a=t.options,o=t.serverState,i=t.children,u=e(!0);return o&&!n.initialised&&n.setState(o),u.current&&(u.current=!1,a?n.init(c(c({},a),{onChange:function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];a.onChange&&a.onChange.apply(a,r),f.trigger("event")}})):n.trigger=function(){return f.trigger("event")}),r.createElement(s.Provider,{value:n},i)},l=function(r){var t=e(r);return t.current||(t.current=r),t.current},g=function(r){if("string"==typeof r)return[r];if("object"==typeof r&&r.hasOwnProperty("length"))return r;throw new Error("Flagsmith: please supply an array of strings or a single string of flag keys to useFlags")},v=function(r,t,e){return void 0===e&&(e=[]),t.map((function(t){return"".concat(r.getValue(t)).concat(r.hasFeature(t))})).concat(e.map((function(t){return"".concat(r.getTrait(t))}))).join(",")};function p(r,t){void 0===t&&(t=[]);var c=l(g(r)),h=l(g(t)),p=n(s),w=a(v(p,c)),d=w[0],y=w[1],m=e(d),b=o((function(){var r=v(p,c,h);r!==m.current&&(m.current=r,y(r))}),[]);return i((function(){return f.on("event",b),function(){f.off("event",b)}}),[]),u((function(){var r={};return c.map((function(t){r[t]={enabled:p.hasFeature(t),value:p.getValue(t)}})).concat(null==h?void 0:h.map((function(t){r[t]=p.getTrait(t)}))),r}),[d])}var w=function(){var r=n(s);if(!r)throw new Error("useFlagsmith must be used with in a FlagsmithProvider");return r};export{s as FlagsmithContext,h as FlagsmithProvider,p as useFlags,w as useFlagsmith};
//# sourceMappingURL=index.js.map
