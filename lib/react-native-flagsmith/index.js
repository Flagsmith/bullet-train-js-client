!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["react-native-flagsmith"]={})}(this,(function(t){"use strict";var e=function(){return e=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},e.apply(this,arguments)};function n(t,e,n){if(n||2===arguments.length)for(var i,r=0,s=e.length;r<s;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))}function i(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})})),e}var r,s,a=function t(e,n){if(e===n)return!0;if(e&&n&&"object"==typeof e&&"object"==typeof n){if(e.constructor!==n.constructor)return!1;var i,r,s;if(Array.isArray(e)){if((i=e.length)!=n.length)return!1;for(r=i;0!=r--;)if(!t(e[r],n[r]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if((i=(s=Object.keys(e)).length)!==Object.keys(n).length)return!1;for(r=i;0!=r--;)if(!Object.prototype.hasOwnProperty.call(n,s[r]))return!1;for(r=i;0!=r--;){var a=s[r];if(!t(e[a],n[a]))return!1}return!0}return e!=e&&n!=n},o=null,l="BULLET_TRAIN_DB",h="BULLET_TRAIN_EVENT",u="https://edge.api.flagsmith.com/api/v1/",c=function(t){return"Attempted to "+t+" a user before calling flagsmith.init. Call flagsmith.init first, if you wish to prevent it sending a request for flags, call init with preventFetch:true."},g=function(){function t(t){var n=this;this.timestamp=null,this.isLoading=!1,this.eventSource=null,this.getJSON=function(t,e,i){var s=n,a=s.environmentID,o=s.headers,l={method:e||"GET",body:i,headers:{"x-environment-key":"".concat(a)}};return e&&"GET"!==e&&(l.headers["Content-Type"]="application/json; charset=utf-8"),o&&Object.assign(l.headers,o),r||console.error("Flagsmith: fetch is undefined, please specify a fetch implementation into flagsmith.init to support SSR."),r(t,l).then((function(i){var r,s=null===(r=i.headers)||void 0===r?void 0:r.get("x-flagsmith-document-updated-at");if(s)try{var a=parseFloat(s);if(isNaN(a))throw"Failed to parse x-flagsmith-document-updated-at";n.timestamp=a}catch(t){n.log(t,"Failed to parse x-flagsmith-document-updated-at",s)}return n.log("Fetch response: "+i.status+" "+(e||"GET")+0+t),i.text().then((function(t){var e=t;try{e=JSON.parse(t)}catch(t){}return i.status&&i.status>=200&&i.status<300?e:Promise.reject(e)}))})).catch((function(t){throw console.error("Flagsmith: Fetch error: "+t),new Error("Flagsmith: Fetch error:"+t)}))},this.getFlags=function(t,i){var r=n,s=r.onChange,o=r.onError,l=r.identity,h=r.api,u=!1;n.log("Get Flags"),n.isLoading=!0;var c=function(t){var i=t.flags,r=t.traits;n.isLoading=!1,l&&(n.withTraits=null);var o={},h={};r=r||[],(i=i||[]).forEach((function(t){o[t.feature.name.toLowerCase().replace(/ /g,"_")]={id:t.feature.id,enabled:t.enabled,value:t.feature_state_value}})),r.forEach((function(t){h[t.trait_key.toLowerCase().replace(/ /g,"_")]=t.trait_value})),n.oldFlags=e({},n.flags);var u=a(n.flags,o),c=a(n.traits,h);if(n.flags=o,n.traits=h,n.updateStorage(),n.dtrum){var g={javaDouble:{},date:{},shortString:{},javaLongOrObject:{}};Object.keys(n.flags).map((function(t){v(g,"flagsmith_value_"+t,n.getValue(t)),v(g,"flagsmith_enabled_"+t,n.hasFeature(t))})),Object.keys(n.traits).map((function(t){v(g,"flagsmith_trait_"+t,n.getTrait(t))})),n.log("Sending javaLongOrObject traits to dynatrace",g.javaLongOrObject),n.log("Sending date traits to dynatrace",g.date),n.log("Sending shortString traits to dynatrace",g.shortString),n.log("Sending javaDouble to dynatrace",g.javaDouble),n.dtrum.sendSessionProperties(g.javaLongOrObject,g.date,g.shortString,g.javaDouble)}s&&s(n.oldFlags,{isFromServer:!0,flagsChanged:!u,traitsChanged:!c})};return l?Promise.all([n.withTraits?n.getJSON(h+"identities/","POST",JSON.stringify({identifier:l,traits:Object.keys(n.withTraits).map((function(t){return{trait_key:t,trait_value:n.withTraits[t]}}))})):n.getJSON(h+"identities/?identifier="+encodeURIComponent(l))]).then((function(e){n.withTraits=null,c(e[0]),t&&!u&&(u=!0,t())})).catch((function(t){var e=t.message;n.isLoading=!1,o&&o({message:e})})):Promise.all([n.getJSON(h+"flags/")]).then((function(e){c({flags:e[0],traits:void 0}),t&&!u&&(u=!0,t())})).catch((function(t){n.isLoading=!1,i&&!u&&(u=!0,i(t)),o&&o(t)}))},this.analyticsFlags=function(){var t=n.api;if(n.evaluationEvent&&n.evaluationEvent[n.environmentID])return n.evaluationEvent&&0!==Object.getOwnPropertyNames(n.evaluationEvent).length&&0!==Object.getOwnPropertyNames(n.evaluationEvent[n.environmentID]).length?n.getJSON(t+"analytics/flags/","POST",JSON.stringify(n.evaluationEvent[n.environmentID])).then((function(t){var i=n.getState();n.evaluationEvent||(n.evaluationEvent={}),n.evaluationEvent[n.environmentID]={},n.setState(e(e({},i),{evaluationEvent:n.evaluationEvent})),n.updateEventStorage()})).catch((function(t){n.log("Exception fetching evaluationEvent",t)})):void 0},this.canUseStorage=!1,this.analyticsInterval=null,this.api=null,this.cacheFlags=!1,this.ts=null,this.enableAnalytics=!1,this.enableLogs=!1,this.environmentID="",this.evaluationEvent=null,this.flags=null,this.getFlagInterval=null,this.headers=null,this.initialised=!1,this.oldFlags=null,this.onChange=null,this.onError=null,this.trigger=null,this.identity=null,this.ticks=null,this.timer=null,this.traits=null,this.dtrum=null,this.withTraits=null,this.cacheOptions={ttl:0,skipAPI:!1},this.evaluateFlag=function(t){if(n.enableAnalytics){if(!n.evaluationEvent)return;n.evaluationEvent[n.environmentID]||(n.evaluationEvent[n.environmentID]={}),void 0===n.evaluationEvent[n.environmentID][t]&&(n.evaluationEvent[n.environmentID][t]=0),n.evaluationEvent[n.environmentID][t]+=1}n.updateEventStorage()},this.getValue=function(t,e){var i=n.flags&&n.flags[t.toLowerCase().replace(/ /g,"_")],r=null;if(i&&(r=i.value),n.evaluateFlag(t),null==e?void 0:e.json)try{return null===r?(n.log("Tried to parse null flag as JSON: "+t),e.fallback):JSON.parse(r)}catch(t){return e.fallback}return r},this.getTrait=function(t){return n.traits&&n.traits[t.toLowerCase().replace(/ /g,"_")]},this.getAllTraits=function(){return n.traits},this.setTrait=function(t,e){if(n.api){var i={};return i[t]=e,n.setTraits(i)}console.error(c("setTrait"))},this.setTraits=function(t){if(n.api){if(t&&"object"==typeof t||console.error("Expected object for flagsmith.setTraits"),n.withTraits=e(e({},n.withTraits||{}),t),n.identity)return n.initialised?n.getFlags():void 0;n.log("Set traits prior to identifying",n.withTraits)}else console.error(c("setTraits"))},this.hasFeature=function(t){var e=n.flags&&n.flags[t.toLowerCase().replace(/ /g,"_")],i=!1;return e&&e.enabled&&(i=!0),n.evaluateFlag(t),i},r=t.fetch?t.fetch:"undefined"!=typeof fetch?fetch:null===global||void 0===global?void 0:global.fetch,this.canUseStorage="undefined"!=typeof window||!!t.browserlessStorage,this.log("Constructing flagsmith instance "+t),t.eventSource&&(s=t.eventSource),t.AsyncStorage&&(o=t.AsyncStorage)}return t.prototype.init=function(t){var n=this,i=t.environmentID,a=t.api,c=void 0===a?u:a,g=t.headers,d=t.onChange,v=t.cacheFlags,f=t.onError,p=t.defaultFlags,y=t.fetch,m=t.preventFetch,S=t.enableLogs,_=t.enableDynatrace,E=t.enableAnalytics,O=t.realtime,b=t.eventSourceUrl,I=void 0===b?"https://realtime.flagsmith.com/":b,w=t.AsyncStorage,x=t.identity,C=t.traits,T=t._trigger,F=t.state,N=t.cacheOptions,j=t.angularHttpClient;return new Promise((function(t,a){if(n.environmentID=i,n.api=c,n.headers=g,n.getFlagInterval=null,n.analyticsInterval=null,n.onChange=function(t,e){d&&d(t,e),n.trigger&&(n.log("trigger called"),n.trigger())},n.trigger=T||n.trigger,n.onError=f?function(t){t instanceof Error?f(t):f(new Error(t))}:null,n.identity=x,n.withTraits=C,n.enableLogs=S||!1,n.cacheOptions=N?{skipAPI:!!N.skipAPI,ttl:N.ttl||0}:n.cacheOptions,!n.cacheOptions.ttl&&n.cacheOptions.skipAPI&&console.warn("Flagsmith: you have set a cache ttl of 0 and are skipping API calls, this means the API will not be hit unless you clear local storage."),y&&(r=y),n.enableAnalytics=E||!1,n.flags=Object.assign({},p)||{},n.initialised=!0,n.ticks=1e4,O&&"undefined"!=typeof window){var u=I+"sse/environments/"+i+"/stream";s?n.eventSource||(n.log("Creating event source with url "+u),n.eventSource=new s(u),n.eventSource.addEventListener("environment_updated",(function(t){var e;try{e=JSON.parse(t.data).updated_at}catch(t){n.log("Could not parse sse event",t)}e?!n.timestamp||e>n.timestamp?n.isLoading?n.log("updated_at is new, but flags are loading",t.data,n.timestamp):(n.log("updated_at is new, fetching flags",t.data,n.timestamp),n.getFlags()):n.log("updated_at is outdated, skipping get flags",t.data,n.timestamp):n.log("No updated_at received, fetching flags",t)}))):n.log("Error, EventSource is undefined")}if(n.log("Initialising with properties",{environmentID:i,api:c,headers:g,onChange:d,cacheFlags:v,onError:f,defaultFlags:p,preventFetch:m,enableLogs:S,enableAnalytics:E,AsyncStorage:o,identity:x,traits:C,_trigger:T,state:F,angularHttpClient:j},n),n.timer=n.enableLogs?(new Date).valueOf():null,w&&(o=w),n.cacheFlags=void 0!==o&&!!v,n.setState(F),!i)throw a("Please specify a environment id"),"Please specify a environment id";_&&("undefined"==typeof dtrum?console.error("You have attempted to enable dynatrace but dtrum is undefined, please check you have the Dynatrace RUM JavaScript API installed."):n.dtrum=dtrum),j&&(r=function(t,e){var n=e.headers,i=e.method,r=e.body;return new Promise((function(e){switch(i){case"GET":return j.get(t,{headers:n}).subscribe((function(t){e({ok:!0,text:function(){return Promise.resolve(t)}})}));case"POST":case"PUT":return j.post(t,r,{headers:n}).subscribe((function(t){e({ok:!0,text:function(){return Promise.resolve(t)}})}))}}))}),o&&n.canUseStorage&&o.getItem(h).then((function(t){if(t)try{n.evaluationEvent=JSON.parse(t)}catch(t){n.evaluationEvent={}}else n.evaluationEvent={};return n.analyticsInterval=setInterval(n.analyticsFlags,n.ticks),!0})),n.enableAnalytics&&(n.analyticsInterval&&clearInterval(n.analyticsInterval),o&&n.canUseStorage&&o.getItem(h,(function(t,i){if(i){var r=JSON.parse(i);r[n.environmentID]&&(F=n.getState(),n.log("Retrieved events from cache",i),n.setState(e(e({},F),{evaluationEvent:r[n.environmentID]})))}return!0}))),v?o&&n.canUseStorage&&o.getItem(l,(function(e,i){if(i)try{var r=JSON.parse(i),s=!1;if(r&&r.api===n.api&&r.environmentID===n.environmentID){var o=!0;n.identity&&r.identity!==n.identity&&(n.log("Ignoring cache,  identity has changed from "+r.identity+" to "+n.identity),o=!1),n.cacheOptions.ttl&&(!r.ts||(new Date).valueOf()-r.ts>n.cacheOptions.ttl)&&r.ts&&(n.log("Ignoring cache, timestamp is too old ts:"+r.ts+" ttl: "+n.cacheOptions.ttl+" time elapsed since cache: "+((new Date).valueOf()-r.ts)+"ms"),o=!1),o&&(s=!0,n.setState(r),n.log("Retrieved flags from cache",r))}n.flags?(n.onChange&&(n.log("onChange called"),n.onChange(null,{isFromServer:!1,flagsChanged:!0,traitsChanged:!!n.traits})),n.oldFlags=n.flags,t(!0),n.cacheOptions.skipAPI&&s&&n.log("Skipping API, using cache"),m||n.cacheOptions.skipAPI&&s||n.getFlags()):m?t(!0):n.getFlags(t,a)}catch(t){n.log("Exception fetching cached logs",t)}else m?(p&&n.onChange&&(n.log("onChange called"),n.onChange(null,{isFromServer:!1,flagsChanged:!0,traitsChanged:!!n.traits})),t(!0)):n.getFlags(t,a);return!0})):m?(p&&n.onChange&&(n.log("onChange called"),n.onChange(null,{isFromServer:!1,flagsChanged:!0,traitsChanged:!!n.traits})),t(!0)):n.getFlags(t,a)})).catch((function(t){n.log("Error during initialisation ",t),f&&f(t)}))},t.prototype.getAllFlags=function(){return this.flags},t.prototype.identify=function(t,n){return this.identity=t,this.log("Identify: "+this.identity),n&&(this.withTraits=e(e({},this.withTraits||{}),n)),this.initialised?this.getFlags():Promise.resolve()},t.prototype.getState=function(){return{api:this.api,environmentID:this.environmentID,flags:this.flags,identity:this.identity,ts:this.ts,traits:this.traits,evaluationEvent:this.evaluationEvent}},t.prototype.setState=function(t){t&&(this.initialised=!0,this.api=t.api||this.api||u,this.environmentID=t.environmentID||this.environmentID,this.flags=t.flags||this.flags,this.identity=t.identity||this.identity,this.traits=t.traits||this.traits,this.evaluationEvent=t.evaluationEvent||this.evaluationEvent,this.log("setState called",this))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enableLogs&&console.log.apply(this,n(["FLAGSMITH:",(new Date).valueOf()-(this.timer||0),"ms"],t,!0))},t.prototype.updateStorage=function(){if(this.cacheFlags){this.ts=(new Date).valueOf();var t=JSON.stringify(this.getState());this.log("Setting storage",t),o.setItem(l,t)}},t.prototype.updateEventStorage=function(){if(this.enableAnalytics){var t=JSON.stringify(this.getState().evaluationEvent);this.log("Setting event storage",t),o.setItem(h,t)}},t.prototype.logout=function(){return this.identity=null,this.traits=null,this.initialised?this.getFlags():Promise.resolve()},t.prototype.startListening=function(t){void 0===t&&(t=1e3),this.getFlagInterval&&clearInterval(this.getFlagInterval),this.getFlagInterval=setInterval(this.getFlags,t)},t.prototype.stopListening=function(){this.getFlagInterval&&(clearInterval(this.getFlagInterval),this.getFlagInterval=null)},t.prototype.getSegments=function(){},t}();function d(t){var e=t.fetch;t.browserlessStorage;var n=t.AsyncStorage,i=t.eventSource;return new g({fetch:e,AsyncStorage:n,eventSource:i})}var v=function(t,e,n){var i="shortString",r=!0;"number"==typeof n&&(i="javaDouble",r=!1),t[i]=t[i]||{},t[i][e]=r?n+"":n};var f,p=i(Object.freeze({__proto__:null,default:class{ERROR=-1;CONNECTING=0;OPEN=1;CLOSED=2;constructor(t,e={}){if(this.interval=e.pollingInterval||5e3,this.lastEventId=null,this.lastIndexProcessed=0,this.eventType=void 0,this.status=this.CONNECTING,this.eventHandlers={open:[],message:[],error:[],close:[]},this.method=e.method||"GET",this.timeout=e.timeOut||0,this.headers=e.headers||{},this.body=e.body||void 0,this.debug=e.debug||!1,this._xhr=null,this._pollTimer=null,!t||"string"!=typeof t&&"function"!=typeof t.toString)throw new SyntaxError("[EventSource] Invalid URL argument.");"function"==typeof t.toString?this.url=t.toString():this.url=t,this._pollAgain(500)}_pollAgain(t){this._pollTimer=setTimeout((()=>{this.open()}),t)}open(){try{if(this.lastIndexProcessed=0,this.status=this.CONNECTING,this._xhr=new XMLHttpRequest,this._xhr.open(this.method,this.url,!0),this.headers)for(const[t,e]of Object.entries(this.headers))this._xhr.setRequestHeader(t,e);this._xhr.setRequestHeader("Accept","text/event-stream"),this._xhr.setRequestHeader("Cache-Control","no-cache"),this._xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),null!==this.lastEventId&&this._xhr.setRequestHeader("Last-Event-ID",this.lastEventId),this._xhr.timeout=this.timeout,this._xhr.onreadystatechange=()=>{const t=this._xhr;this.debug&&console.debug(`[EventSource][onreadystatechange] ReadyState: ${t.readyState}, status: ${t.status}`),[XMLHttpRequest.DONE,XMLHttpRequest.LOADING].includes(t.readyState)&&(t.status>=200&&t.status<400?(this.status===this.CONNECTING&&(this.status=this.OPEN,this.dispatch("open",{type:"open"})),this._handleEvent(t.responseText||""),t.readyState===XMLHttpRequest.DONE&&(this.debug&&console.debug("[EventSource][onreadystatechange][DONE] Operation done. Reconnecting..."),this._pollAgain(this.interval))):this.status!==this.CLOSED&&(0!==this._xhr.status&&this.dispatch("error",{type:"error",message:t.responseText,xhrStatus:t.status,xhrState:t.readyState}),[XMLHttpRequest.DONE,XMLHttpRequest.UNSENT].includes(t.readyState)&&(this.debug&&console.debug("[EventSource][onreadystatechange][ERROR] Response status error. Reconnecting..."),this._pollAgain(this.interval))))},this._xhr.onerror=t=>{this.status,this.ERROR,this.dispatch("error",{type:"error",message:this._xhr.responseText,xhrStatus:this._xhr.status,xhrState:this._xhr.readyState})},this.body?this._xhr.send(this.body):this._xhr.send(),this.timeout>0&&setTimeout((()=>{this._xhr.readyState===XMLHttpRequest.LOADING&&(this.dispatch("error",{type:"timeout"}),this.close())}),this.timeout)}catch(t){this.status=this.ERROR,this.dispatch("error",{type:"exception",message:t.message,error:t})}}_handleEvent(t){const e=t.substr(this.lastIndexProcessed).split("\n");this.lastIndexProcessed=t.lastIndexOf("\n\n")+2;let n=[],i=0,r="";for(let t=0;t<e.length;t++)if(r=e[t].replace(/^(\s|\u00A0)+|(\s|\u00A0)+$/g,""),0===r.indexOf("event"))this.eventType=r.replace(/event:?\s*/,"");else if(0===r.indexOf("retry"))i=parseInt(r.replace(/retry:?\s*/,""),10),isNaN(i)||(this.interval=i);else if(0===r.indexOf("data"))n.push(r.replace(/data:?\s*/,""));else if(0===r.indexOf("id:"))this.lastEventId=r.replace(/id:?\s*/,"");else if(0===r.indexOf("id"))this.lastEventId=null;else if(""===r&&n.length>0){const t=this.eventType||"message",e={type:t,data:n.join("\n"),url:this.url,lastEventId:this.lastEventId};this.dispatch(t,e),n=[],this.eventType=void 0}}addEventListener(t,e){void 0===this.eventHandlers[t]&&(this.eventHandlers[t]=[]),this.eventHandlers[t].push(e)}removeEventListener(t,e){void 0!==this.eventHandlers[t]&&(this.eventHandlers[t]=this.eventHandlers[t].filter((t=>t!==e)))}removeAllEventListeners(t){const e=Object.keys(this.eventHandlers);if(void 0===t)for(const t of e)this.eventHandlers[t]=[];else{if(!e.includes(t))throw Error(`[EventSource] '${t}' type is not supported event type.`);this.eventHandlers[t]=[]}}dispatch(t,e){if(Object.keys(this.eventHandlers).includes(t))for(const n of Object.values(this.eventHandlers[t]))n(e)}close(){this.status=this.CLOSED,clearTimeout(this._pollTimer),this._xhr&&this._xhr.abort(),this.dispatch("close",{type:"close"})}}})),y=(f=function(t,e){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},f(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}f(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),m=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},S=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,s=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=s.next()).done;)a.push(i.value)}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return a},_=function(t,e,n){if(n||2===arguments.length)for(var i,r=0,s=e.length;r<s;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))},E=function(t){function e(){return t.call(this,"EventSource not available.\nConsider loading an EventSource polyfill and making it available globally as EventSource, or passing one in as eventSourceClass to the ReconnectingEventSource constructor.")||this}return y(e,t),e}(Error),O=function(){function t(t,e){var n=this;if(this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,this._configuration=null!=e?Object.assign({},e):void 0,this.withCredentials=!1,this._eventSource=null,this._lastEventId=null,this._timer=null,this._listeners={open:[],error:[],message:[]},this.url=t.toString(),this.readyState=this.CONNECTING,this.max_retry_time=3e3,this.eventSourceClass=globalThis.FlagsmithEventSource,null!=this._configuration&&(this._configuration.lastEventId&&(this._lastEventId=this._configuration.lastEventId,delete this._configuration.lastEventId),this._configuration.max_retry_time&&(this.max_retry_time=this._configuration.max_retry_time,delete this._configuration.max_retry_time),this._configuration.eventSourceClass&&(this.eventSourceClass=this._configuration.eventSourceClass,delete this._configuration.eventSourceClass)),null==this.eventSourceClass||"function"!=typeof this.eventSourceClass)throw new E;this._onevent_wrapped=function(t){n._onevent(t)},this._start()}return t.prototype.dispatchEvent=function(t){throw new Error("Method not implemented.")},t.prototype._start=function(){var t,e,n=this,i=this.url;this._lastEventId&&(-1===i.indexOf("?")?i+="?":i+="&",i+="lastEventId="+encodeURIComponent(this._lastEventId)),this._eventSource=new this.eventSourceClass(i,this._configuration),this._eventSource.onopen=function(t){n._onopen(t)},this._eventSource.onerror=function(t){n._onerror(t)},this._eventSource.onmessage=function(t){n.onmessage(t)};try{for(var r=m(Object.keys(this._listeners)),s=r.next();!s.done;s=r.next()){var a=s.value;this._eventSource.addEventListener(a,this._onevent_wrapped)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype._onopen=function(t){0===this.readyState&&(this.readyState=1,this.onopen(t))},t.prototype._onerror=function(t){var e=this;if(1===this.readyState&&(this.readyState=0,this.onerror(t)),this._eventSource){this._eventSource.close(),this._eventSource=null;var n=Math.round(this.max_retry_time*Math.random());this._timer=setTimeout((function(){return e._start()}),n)}},t.prototype._onevent=function(t){var e,n;t&&t.lastEventId&&(this._lastEventId=t.lastEventId);var i=this._listeners[t.type];if(null!=i)try{for(var r=m(_([],S(i),!1)),s=r.next();!s.done;s=r.next()){s.value.call(this,t)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}"message"===t.type&&this.onmessage(t)},t.prototype.onopen=function(t){},t.prototype.onerror=function(t){},t.prototype.onmessage=function(t){},t.prototype.close=function(){this._timer&&(clearTimeout(this._timer),this._timer=null),this._eventSource&&(this._eventSource.close(),this._eventSource=null),this.readyState=2},t.prototype.addEventListener=function(t,e,n){null==this._listeners[t]&&(this._listeners[t]=[],null!=this._eventSource&&this._eventSource.addEventListener(t,this._onevent_wrapped));var i=this._listeners[t];i.includes(e)||(this._listeners[t]=_(_([],S(i),!1),[e],!1))},t.prototype.removeEventListener=function(t,e,n){var i=this._listeners[t];this._listeners[t]=i.filter((function(t){return t!==e}))},t}();global.FlagsmithEventSource=p.default;var b=d({browserlessStorage:!0,eventSource:O});t.createFlagsmithInstance=()=>d({browserlessStorage:!0,eventSource:O}),t.default=b,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=index.js.map
