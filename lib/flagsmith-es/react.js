import t,{createContext as n,useRef as e,useContext as r,useState as i,useCallback as o,useEffect as a,useMemo as u}from"react";var c=function(){return c=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t},c.apply(this,arguments)},l={exports:{}};function f(){}f.prototype={on:function(t,n,e){var r=this.e||(this.e={});return(r[t]||(r[t]=[])).push({fn:n,ctx:e}),this},once:function(t,n,e){var r=this;function i(){r.off(t,i),n.apply(e,arguments)}return i._=n,this.on(t,i,e)},emit:function(t){for(var n=[].slice.call(arguments,1),e=((this.e||(this.e={}))[t]||[]).slice(),r=0,i=e.length;r<i;r++)e[r].fn.apply(e[r].ctx,n);return this},off:function(t,n){var e=this.e||(this.e={}),r=e[t],i=[];if(r&&n)for(var o=0,a=r.length;o<a;o++)r[o].fn!==n&&r[o].fn._!==n&&i.push(r[o]);return i.length?e[t]=i:delete e[t],this}},l.exports=f,l.exports.TinyEmitter=f;var s=new l.exports.TinyEmitter,g=n(null),v=function(n){var r=n.flagsmith,i=n.options,o=n.serverState,a=n.children,u=e(!0);return r&&!(null==r?void 0:r._trigger)&&(r._trigger=function(){r.log("React - trigger event received"),s.emit("event")}),r&&!(null==r?void 0:r._triggerLoadingState)&&(r._triggerLoadingState=function(){s.emit("loading_event")}),o&&!r.initialised&&r.setState(o),u.current&&(u.current=!1,i&&r.init(c(c({},i),{state:i.state||o,onChange:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];i.onChange&&i.onChange.apply(i,t)}}))),t.createElement(g.Provider,{value:r},a)},h=function(t){var n=e(t);return n.current||(n.current=t),n.current},p=function(t){if("string"==typeof t)return[t];if("object"==typeof t&&t.hasOwnProperty("length"))return t;throw new Error("Flagsmith: please supply an array of strings or a single string of flag keys to useFlags")},d=function(t,n,e){return void 0===e&&(e=[]),n.map((function(n){return"".concat(t.getValue(n)).concat(t.hasFeature(n))})).concat(e.map((function(n){return"".concat(t.getTrait(n))}))).join(",")};function m(){var t=r(g),n=i(null==t?void 0:t.loadingState),e=n[0],u=n[1],c=o((function(){u(null==t?void 0:t.loadingState)}),[t]);return a((function(){return s.on("event",c),function(){s.off("event",c)}}),[c]),e}function y(t,n){void 0===n&&(n=[]);var c=e(!0),l=h(p(t)),f=h(p(n)),v=r(g),m=i(d(v,l,f)),y=m[0],w=m[1],x=o((function(){var t=d(v,l,f);t!==y&&(null==v||v.log("React - useFlags flags and traits have changed"),w(t))}),[y]);return c.current&&(c.current=!1,null==v||v.log("React - Initialising event listeners")),a((function(){return s.on("event",x),function(){s.off("event",x)}}),[x]),u((function(){var t={};return l.map((function(n){t[n]={enabled:v.hasFeature(n),value:v.getValue(n)}})).concat(null==f?void 0:f.map((function(n){t[n]=v.getTrait(n)}))),t}),[y])}function w(){var t=r(g);if(!t)throw new Error("useFlagsmith must be used with in a FlagsmithProvider");return t}export{g as FlagsmithContext,v as FlagsmithProvider,y as useFlags,w as useFlagsmith,m as useFlagsmithLoading};
//# sourceMappingURL=react.js.map
