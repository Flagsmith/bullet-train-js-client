import t,{createContext as n,useRef as e,useContext as r,useState as i,useCallback as o,useEffect as a,useMemo as u}from"react";var c=function(){return c=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t},c.apply(this,arguments)},s={exports:{}};function f(){}f.prototype={on:function(t,n,e){var r=this.e||(this.e={});return(r[t]||(r[t]=[])).push({fn:n,ctx:e}),this},once:function(t,n,e){var r=this;function i(){r.off(t,i),n.apply(e,arguments)}return i._=n,this.on(t,i,e)},emit:function(t){for(var n=[].slice.call(arguments,1),e=((this.e||(this.e={}))[t]||[]).slice(),r=0,i=e.length;r<i;r++)e[r].fn.apply(e[r].ctx,n);return this},off:function(t,n){var e=this.e||(this.e={}),r=e[t],i=[];if(r&&n)for(var o=0,a=r.length;o<a;o++)r[o].fn!==n&&r[o].fn._!==n&&i.push(r[o]);return i.length?e[t]=i:delete e[t],this}},s.exports=f,s.exports.TinyEmitter=f;var l=new s.exports.TinyEmitter,g=n(null),h=function(n){var r=n.flagsmith,i=n.options,o=n.serverState,a=n.children,u=e(!0);return r&&!(null==r?void 0:r.trigger)&&(r.trigger=function(){r.log("React - trigger event received"),l.emit("event")}),o&&!r.initialised&&r.setState(o),u.current&&(u.current=!1,i&&r.init(c(c({},i),{state:i.state||o,onChange:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];i.onChange&&i.onChange.apply(i,t)}}))),t.createElement(g.Provider,{value:r},a)},p=function(t){var n=e(t);return n.current||(n.current=t),n.current},v=function(t){if("string"==typeof t)return[t];if("object"==typeof t&&t.hasOwnProperty("length"))return t;throw new Error("Flagsmith: please supply an array of strings or a single string of flag keys to useFlags")},m=function(t,n,e){return void 0===e&&(e=[]),n.map((function(n){return"".concat(t.getValue(n)).concat(t.hasFeature(n))})).concat(e.map((function(n){return"".concat(t.getTrait(n))}))).join(",")};function y(t,n){void 0===n&&(n=[]);var c=e(!0),s=p(v(t)),f=p(v(n)),h=r(g),y=i(m(h,s,f)),d=y[0],w=y[1],x=o((function(){var t=m(h,s,f);t!==d&&(null==h||h.log("React - useFlags flags and traits have changed"),w(t))}),[d]);return c.current&&(c.current=!1,null==h||h.log("React - Initialising event listeners")),a((function(){return l.on("event",x),function(){l.off("event",x)}}),[x]),u((function(){var t={};return s.map((function(n){t[n]={enabled:h.hasFeature(n),value:h.getValue(n)}})).concat(null==f?void 0:f.map((function(n){t[n]=h.getTrait(n)}))),t}),[d])}function d(){var t=r(g);if(!t)throw new Error("useFlagsmith must be used with in a FlagsmithProvider");return t}export{g as FlagsmithContext,h as FlagsmithProvider,y as useFlags,d as useFlagsmith};
//# sourceMappingURL=react.js.map
