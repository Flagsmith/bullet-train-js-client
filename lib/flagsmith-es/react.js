import t,{createContext as n,useRef as e,useContext as r,useState as i,useCallback as o,useEffect as a,useMemo as u}from"react";var c=function(){return c=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t},c.apply(this,arguments)},l={exports:{}};function s(){}s.prototype={on:function(t,n,e){var r=this.e||(this.e={});return(r[t]||(r[t]=[])).push({fn:n,ctx:e}),this},once:function(t,n,e){var r=this;function i(){r.off(t,i),n.apply(e,arguments)}return i._=n,this.on(t,i,e)},emit:function(t){for(var n=[].slice.call(arguments,1),e=((this.e||(this.e={}))[t]||[]).slice(),r=0,i=e.length;r<i;r++)e[r].fn.apply(e[r].ctx,n);return this},off:function(t,n){var e=this.e||(this.e={}),r=e[t],i=[];if(r&&n)for(var o=0,a=r.length;o<a;o++)r[o].fn!==n&&r[o].fn._!==n&&i.push(r[o]);return i.length?e[t]=i:delete e[t],this}},l.exports=s,l.exports.TinyEmitter=s;var f=new l.exports.TinyEmitter,g=n(null),h=function(n){var r=n.flagsmith,i=n.options,o=n.serverState,a=n.children,u=e(!0);return null==r||(r.trigger=function(){r.log("React - trigger event received"),f.emit("event")}),o&&!r.initialised&&r.setState(o),u.current&&(u.current=!1,i&&r.init(c(c({},i),{onChange:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];i.onChange&&i.onChange.apply(i,t),f.emit("event")}}))),t.createElement(g.Provider,{value:r},a)},v=function(t){var n=e(t);return n.current||(n.current=t),n.current},p=function(t){if("string"==typeof t)return[t];if("object"==typeof t&&t.hasOwnProperty("length"))return t;throw new Error("Flagsmith: please supply an array of strings or a single string of flag keys to useFlags")},m=function(t,n,e){return void 0===e&&(e=[]),n.map((function(n){return"".concat(t.getValue(n)).concat(t.hasFeature(n))})).concat(e.map((function(n){return"".concat(t.getTrait(n))}))).join(",")};function y(t,n){void 0===n&&(n=[]);var c=e(!0),l=v(p(t)),s=v(p(n)),h=r(g),y=i(m(h,l)),d=y[0],w=y[1],x=e(d),R=o((function(){null==h||h.log("React - Event listener triggered");var t=m(h,l,s);t!==x.current&&(x.current=t,w(t))}),[]);return c.current&&(c.current=!1,null==h||h.log("React - Initialising event listeners"),f.on("event",R)),a((function(){return function(){null==h||h.log("React - Removing event listeners"),f.off("event",R)}}),[]),u((function(){null==h||h.log("React - Render key has changed");var t={};return l.map((function(n){t[n]={enabled:h.hasFeature(n),value:h.getValue(n)}})).concat(null==s?void 0:s.map((function(n){t[n]=h.getTrait(n)}))),t}),[d])}function d(){var t=r(g);if(!t)throw new Error("useFlagsmith must be used with in a FlagsmithProvider");return t}export{g as FlagsmithContext,h as FlagsmithProvider,y as useFlags,d as useFlagsmith};
//# sourceMappingURL=react.js.map
